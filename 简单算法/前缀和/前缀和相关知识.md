<h1 style="text-align: center;">前缀和讲义</h1>

### 一维前缀和

思考如下问题：

> 给定一个有 $n(1 \leq n \leq 10^5)$ 个数字的序列 $a$，有 $q(1 \leq q \leq 10^5)$ 次询问，每次询问输入两个正整数 $l,r(1 \leq l,r \leq n)$ ，请你给出 $a_l+...+a_r$的和

```c++
for (int i = 1; i <= n; i++) cin >> a[i];
while (q--)
{
    int l, r, sum = 0;
    cin >> l >> r;
    for (int i = l; i <= r; i++) sum += a[i];
    cout << sum << endl;
}
```

考虑上面算法的时间复杂度，外层循环 $n$  ，内层循环 $q$ 次，为 $O(n \times q)$，由于 $n,q$  最大都能取到 $10^5$，肯定超时了。 那有没有什么办法可以快速求得 $[l,r]$ 之间的区间和呢？当然有，那就是前缀和数组的妙用了。

**前缀和** 是指一个数组中，从第一个元素开始，到当前元素为止的所有元素之和。
下面是一个前缀和的例子：假设有一个数组 $[1, 2, 3, 4, 5]$，我们可以计算它的前缀和数组 $sum$ 为 $[1, 3, 6, 10, 15]$。这个前缀和数组的含义是，$sum[1]$ 为 $1$，$sum[2]$ 为 $1 + 2 = 3$，$sum[3]$ 为 $1 + 2 + 3 = 6$，以此类推。。。
可以发现，对于数组 $a$，其前缀和数组中的元素： 
$sum[1] = a[1]$
$sum[2] = a[1]+a[2]$
$sum[3] = a[1]+a[2]+a[3]$
...
$sum[i] = a[1]+a[2]+a[3]+...+a[i] = sum[i-1]+a[i]$

所以前缀和的构造公式就是：$sum[i] = sum[i-1]+a[i]$。

来看如下例子：

![image.png](https://oj.noionline.cn/api/public/img/49a25618d0db4769981b55baa0ecfab1.png)

回到我们的问题，我们要求的是给定一段区间 $[l,r]$ 之间的和，那这个前缀和数组有什么用呢，它又如何帮我们求区间和？

![image.png](https://oj.noionline.cn/api/public/img/b6430d72517d4187935fb616dac89dc5.png)

到这里可以发现，要求 $a[l]+...+a[r]$ 之间的区间和，只需要构造出 $a$ 的前缀和数组 $s$ 后，用 $s[r] - s[l-1]$ 即可求出，时间复杂度为 $O(1)$。

前缀和参考代码：

```c++
int a[N], s[N];

for (int i = 1; i <= n; i++) cin >> a[i];  // 读入原数组
for (int i = 1; i <= n; i++) s[i] = s[i-1] + a[i];  // 预处理前缀和数组

while (q--)
{
    int l, r;
    cin >> l >> r;
    cout << s[r] - s[l-1] << endl;  // 快速求给定区间的和
}
```



### 二维前缀和

二维前缀和的原理和一维前缀和类似，不过求的是一个矩阵内的所有元素的和。

![](https://img-blog.csdnimg.cn/1267dd6a84a14ea3820309f176ae8910.png)

例如上图标蓝的部分，就是从 $(1,1)$ 到 $(4,3)$ 的所有元素的总和，即，对于二维前缀和 $s[i][j]$，表示的是矩阵 $a[1][1]+...+a[i][j]$ 的总和。

那么如何求出二维前缀和呢？对于上面展示的矩阵，如果要求 $s[4][3]$，我们要思考的就是如何求出 **剔除 $a[4][3]$ 后的那一块区域的值**。

可以发现，其实就是 $s[3][3]+s[4][2]-s[3][2]$，最后再加上 $a[4][3]$ 就可以求出这块的前缀和了。

展开来说，$s[i][j] = s[i-1][j]+s[i][j-1]-s[i-1][j-1]+a[i][j]$，就是二维前缀和的递推公式了。



<span style="color: red; font-weight: bolder">二维前缀和的作用：求矩阵中某一个小矩阵的元素总和</span>。

思考一下，如果要求  左上角坐标为 $(x1, y1)$，右下角的坐标为 $(x2, y2)$ 的矩阵元素和，如何利用前缀和矩阵来求呢？

![c1c318f449504306a5d1302a3e712d50.png](https://img-blog.csdnimg.cn/c1c318f449504306a5d1302a3e712d50.png)

即，求 左上角坐标为 $(x1, y1)$，右下角的坐标为 $(x2, y2)$ 的矩阵元素和，公式为：

$s[x2][y2]-s[x1-1][y2]-s[x2][y1-1]+s[x1-1][y1-1]$

